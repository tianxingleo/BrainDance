
---

# ğŸ§  BrainDance AI Engine - 3DGS Cloud Node

> **BrainDance æ ¸å¿ƒè®¡ç®—åç«¯**ï¼šåŸºäº Supabase æ¶ˆæ¯é˜Ÿåˆ—ä¸ Nerfstudio çš„äº‘åŸç”Ÿ 3D é«˜æ–¯æ³¼æº…ï¼ˆ3DGSï¼‰ç”Ÿæˆå¼•æ“ã€‚

æœ¬é¡¹ç›®æ˜¯ BrainDance çš„æ ¸å¿ƒ AI ç®—åŠ›èŠ‚ç‚¹ï¼Œè´Ÿè´£ç›‘å¬äº‘ç«¯ä»»åŠ¡ã€è‡ªåŠ¨ä¸‹è½½ç”¨æˆ·ä¸Šä¼ çš„è§†é¢‘ã€æ‰§è¡Œå…¨è‡ªåŠ¨ 3D é‡å»ºæµç¨‹ï¼ˆCOLMAP/GLOMAP + Splatfactoï¼‰ï¼Œå¹¶å°†æœ€ç»ˆçš„ 3D æ¨¡å‹ï¼ˆPLYï¼‰ä¸æ—¥å¿—å®æ—¶å›ä¼ è‡³äº‘ç«¯ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

* **â˜ï¸ äº‘åŸç”Ÿæ¶æ„**ï¼šé€šè¿‡ Supabase å®ç°å®Œå…¨è§£è€¦çš„â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼ï¼Œå‰ç«¯åªç®¡å‘ä»»åŠ¡ï¼Œåç«¯è‡ªåŠ¨æ’é˜Ÿå¤„ç†ã€‚
* **ğŸ”„ å…¨è‡ªåŠ¨æµæ°´çº¿**ï¼šä¸€é”®å®Œæˆ `è§†é¢‘æŠ½å¸§` -> `ä½å§¿è§£ç®— (COLMAP)` -> `AI åœºæ™¯åˆ†æ` -> `3DGS è®­ç»ƒ` -> `æ¨¡å‹åå¤„ç†`ã€‚
* **ğŸ“¡ å®æ—¶çŠ¶æ€åŒæ­¥**ï¼šè®­ç»ƒè¿›åº¦ä¸è¯¦ç»†æ—¥å¿—å®æ—¶æ¨é€åˆ° Supabase æ•°æ®åº“ï¼Œæ”¯æŒå‰ç«¯è¿œç¨‹ç›‘æ§ã€‚
* **ğŸš€ æ··åˆè¿è¡Œæ¨¡å¼**ï¼šæ”¯æŒ `æœ¬åœ°è°ƒè¯•æ¨¡å¼`ï¼ˆç›´æ¥å¤„ç†æ–‡ä»¶ï¼‰å’Œ `äº‘ç«¯ç›‘å¬æ¨¡å¼`ï¼ˆæ— äººå€¼å®ˆå·¥å•å¤„ç†ï¼‰ã€‚

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
BrainDance/
â”œâ”€â”€ main.py                    # [å…¥å£] ç¨‹åºå¯åŠ¨å…¥å£ (æ¨¡å¼é€‰æ‹©å™¨)
â”œâ”€â”€ .env                       # [é…ç½®] ç¯å¢ƒå˜é‡ (Supabase Key ç­‰æ•æ„Ÿä¿¡æ¯)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config.py              # [é…ç½®] PipelineConfig é…ç½®ç±»å®šä¹‰
â”‚   â”œâ”€â”€ core/                  # [æ ¸å¿ƒé€»è¾‘]
â”‚   â”‚   â”œâ”€â”€ pipeline.py        # 3DGS ç”Ÿæˆä¸»æµæ°´çº¿ (run_pipeline)
â”‚   â”‚   â””â”€â”€ worker.py          # Supabase è½®è¯¢å™¨ä¸ä¸Šä¼ ä¸‹è½½é€»è¾‘
â”‚   â”œâ”€â”€ modules/               # [åŠŸèƒ½æ¨¡å—]
â”‚   â”‚   â”œâ”€â”€ ai_segmentor.py    # AI è¯­ä¹‰åˆ†å‰²ä¸ç‰©ä½“æå–
â”‚   â”‚   â”œâ”€â”€ glomap_runner.py   # GLOMAP/COLMAP ä½å§¿è§£ç®—å°è£…
â”‚   â”‚   â”œâ”€â”€ image_proc.py      # å›¾åƒé¢„å¤„ç† (æŠ½å¸§ã€é”åŒ–ç­‰)
â”‚   â”‚   â””â”€â”€ nerf_engine.py     # Nerfstudio è®­ç»ƒå¼•æ“å°è£…
â”‚   â””â”€â”€ utils/                 # [å·¥å…·åº“]
â”‚       â”œâ”€â”€ common.py          # é€šç”¨å·¥å…· (å¦‚æ—¶é—´æ ¼å¼åŒ–)
â”‚       â”œâ”€â”€ cv_algorithms.py   # è®¡ç®—æœºè§†è§‰ç®—æ³• (Maskå¤„ç†ã€åŒ…å›´ç›’è®¡ç®—)
â”‚       â”œâ”€â”€ geometry.py        # å‡ ä½•åˆ†æ (è‡ªåŠ¨è®¡ç®—è£å‰ªæ¡†)
â”‚       â””â”€â”€ ply_utils.py       # PLY ç‚¹äº‘åå¤„ç†å·¥å…·

```

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. ç¡¬ä»¶è¦æ±‚

* **GPU**: NVIDIA RTX 30/40/50 ç³»åˆ— (æ˜¾å­˜ >= 8GB)
* **OS**: Linux (æ¨è Ubuntu 22.04) æˆ– Windows WSL2
* **CUDA**: 11.8 æˆ– 12.x

### 2. è½¯ä»¶ä¾èµ–

ç¡®ä¿å·²å®‰è£… `nerfstudio` å’Œ `ffmpeg`ã€‚

```bash
# 1. åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ
conda create -n braindance python=3.10
conda activate braindance

# 2. å®‰è£… PyTorch (æ ¹æ®ä½ çš„ CUDA ç‰ˆæœ¬è°ƒæ•´)
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu118

# 3. å®‰è£…ä¾èµ–åº“
pip install nerfstudio supabase python-dotenv

```

### 3. ç¯å¢ƒå˜é‡é…ç½® (.env)

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»º `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ Supabase é…ç½®ï¼š

```ini
# Supabase è¿æ¥ä¿¡æ¯
SUPABASE_URL=http://127.0.0.1:54321
SUPABASE_KEY=your_service_role_key_here

# å­˜å‚¨æ¡¶ä¸è¡¨åé…ç½®
SUPABASE_BUCKET=braindance-assets
SUPABASE_TABLE=processing_tasks

```

## ğŸ’¾ æ•°æ®åº“è®¾è®¡ (Supabase)

è¯·ç¡®ä¿ Supabase ä¸­åŒ…å«ä»¥ä¸‹ Table å’Œ Storage Bucketã€‚

### Table: `processing_tasks`

| å­—æ®µå | ç±»å‹ | æè¿° |
| --- | --- | --- |
| `id` | `uuid` | ä¸»é”®ï¼Œè‡ªåŠ¨ç”Ÿæˆ |
| `user_id` | `text` | ç”¨æˆ· ID |
| `scene_id` | `text` | åœºæ™¯/é¡¹ç›®å”¯ä¸€æ ‡è¯† |
| `status` | `text` | çŠ¶æ€: `pending` (æ’é˜Ÿ), `processing` (å¤„ç†ä¸­), `completed` (å®Œæˆ), `failed` (å¤±è´¥) |
| `logs` | `jsonb` | å®æ—¶æ—¥å¿—æ•°ç»„ï¼Œç»“æ„: `[{"ts": 123, "msg": "..."}]` |
| `created_at` | `timestamp` | åˆ›å»ºæ—¶é—´ |

### Storage Bucket: `braindance-assets`

æ–‡ä»¶å­˜å‚¨è·¯å¾„è§„èŒƒï¼š

* **è¾“å…¥è§†é¢‘**: `{user_id}/{scene_id}/raw/video.mp4`
* **è¾“å‡ºæ¨¡å‹**: `{user_id}/{scene_id}/output/point_cloud.ply`

## ğŸš€ è¿è¡ŒæŒ‡å—

### æ¨¡å¼ Aï¼šäº‘ç«¯ç›‘å¬æ¨¡å¼ (ç”Ÿäº§ç¯å¢ƒ)

å¯åŠ¨ Workerï¼ŒæŒç»­ç›‘å¬ Supabase çš„ `pending` ä»»åŠ¡ã€‚

```bash
python main.py

```

*è¾“å‡ºç¤ºä¾‹ï¼š*

> ğŸš€ [CloudWorker] å¯åŠ¨! æ­£åœ¨ç›‘å¬è¡¨: [processing_tasks]
> .....
> ğŸ“¥ [æ¥æ”¶ä»»åŠ¡] ID: ... | Scene: party_01

### æ¨¡å¼ Bï¼šæœ¬åœ°è°ƒè¯•æ¨¡å¼ (å¼€å‘æµ‹è¯•)

ä¸ç»è¿‡æ•°æ®åº“ï¼Œç›´æ¥å¤„ç†æœ¬åœ°è§†é¢‘æ–‡ä»¶ã€‚

```bash
python main.py /path/to/your/video.mp4

```

*è¾“å‡ºç¤ºä¾‹ï¼š*

> ğŸ’¿ å¯åŠ¨æœ¬åœ°æ¨¡å¼: video.mp4
> ... (å¼€å§‹ç›´æ¥è¿è¡Œ Pipeline)

## ğŸ”„ å·¥ä½œæµåŸç†

1. **ç”¨æˆ·** åœ¨å‰ç«¯ä¸Šä¼ è§†é¢‘ï¼ŒSupabase Storage å­˜å…¥æ–‡ä»¶ï¼ŒDatabase æ’å…¥ä¸€æ¡ `status='pending'` çš„è®°å½•ã€‚
2. **Worker** (`worker.py`) è½®è¯¢æ£€æµ‹åˆ°æ–°è®°å½•ï¼Œå°†çŠ¶æ€æ”¹ä¸º `processing`ã€‚
3. **ä¸‹è½½**ï¼šè‡ªåŠ¨ä» Storage ä¸‹è½½ `video.mp4` åˆ°æœ¬åœ°ä¸´æ—¶ç›®å½•ã€‚
4. **ç”Ÿæˆ**ï¼šè°ƒç”¨ `pipeline.py`ï¼Œæ‰§è¡Œ COLMAP è§£ç®—ä¸ Gaussian Splatting è®­ç»ƒã€‚
5. **åŒæ­¥**ï¼šè®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ—¥å¿—é€šè¿‡å›è°ƒå‡½æ•°å®æ—¶å†™å…¥ Database çš„ `logs` å­—æ®µã€‚
6. **ä¸Šä¼ **ï¼šè®­ç»ƒç»“æŸåï¼Œå°†ç”Ÿæˆçš„ PLY æ¨¡å‹ä¸Šä¼ å› Storageã€‚
7. **å®Œæˆ**ï¼šæ›´æ–° Database è®°å½•çŠ¶æ€ä¸º `completed`ã€‚

---

*BrainDance Team Â© 2026*