- - ### ä¸€ã€ è¯¦ç»†æŠ€æœ¯æ ˆæ¸…å• (The Tech Stack)

    #### 1. ç§»åŠ¨ç«¯ (Mobile Client)

    è´Ÿè´£ç”¨æˆ·äº¤äº’ã€æ–‡ä»¶ä¸Šä¼ ã€ä»¥åŠæ‰¿è½½ 3D æµè§ˆå™¨ã€‚

    - **å¼€å‘æ¡†æ¶**: **Flutter** (Dart)
      - *ç†ç”±*: ä¸€å¥—ä»£ç è·¨ Android/iOSï¼Œæ€§èƒ½æ¥è¿‘åŸç”Ÿã€‚
    - **ç½‘ç»œé€šä¿¡**: **Dio**
      - *ç”¨é€”*: å¤„ç† REST API è¯·æ±‚ã€å¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ ï¼ˆæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰ã€æ‹¦æˆªå™¨ç®¡ç†ã€‚
    - **Web å®¹å™¨**: **webview_flutter**
      - *ç”¨é€”*: åµŒå…¥ Vue3 é¡µé¢ï¼Œå»ºç«‹ JSBridge é€šä¿¡é€šé“ã€‚
    - **UI ç»„ä»¶åº“**: Material Design 3 (Flutter åŸç”Ÿ)

    #### 2. Web 3D æµè§ˆå™¨ (Embedded 3D Viewer)

    åµŒå…¥åœ¨ Flutter ä¸­çš„ç½‘é¡µï¼Œä¸“é—¨è´Ÿè´£æ¸²æŸ“ 3DGS æ¨¡å‹ã€‚

    - **å‰ç«¯æ¡†æ¶**: **Vue 3** (Composition API)
    - **3D å¼•æ“**: **Three.js** + **WebGL**
      - *æ ¸å¿ƒåŠ è½½å™¨*: `KSplatLoader` æˆ– `LumaSplatsSemantics` (ç”¨äºåŠ è½½ .ply/.splat æ–‡ä»¶)ã€‚
    - **æ„å»ºå·¥å…·**: **Vite** (æ‰“åŒ…æˆé™æ€ HTML/JS/CSS èµ„æºä¾› Flutter åŠ è½½)ã€‚

    #### 3. ä¸šåŠ¡åç«¯ (Business Server)

    ç³»ç»Ÿçš„â€œå¤§è„‘â€ï¼Œè´Ÿè´£è½»é‡çº§é€»è¾‘ã€è°ƒåº¦å’Œå…ƒæ•°æ®ç®¡ç†ã€‚

    - **è¯­è¨€**: **Go (Golang 1.20+)**
    - **Web æ¡†æ¶**: **Gin**
      - *ç†ç”±*: æç®€ã€é«˜æ€§èƒ½ï¼Œé€‚åˆæ„å»º RESTful APIã€‚
    - **ORM æ¡†æ¶**: **GORM** (è¿æ¥ MySQL)ã€‚
    - **Redis å®¢æˆ·ç«¯**: **go-redis** (ç”¨äºç”Ÿäº§ä»»åŠ¡æ¶ˆæ¯)ã€‚
    - **å¯¹è±¡å­˜å‚¨ SDK**: **MinIO-go** (ç”¨äºç­¾å‘ä¸Šä¼ /ä¸‹è½½çš„é¢„ç­¾å URL)ã€‚

    #### 4. è®¡ç®—åç«¯ (AI Engine / Worker)

    è¿è¡Œåœ¨ WSL/Linux GPU æœåŠ¡å™¨ä¸Šï¼Œè´Ÿè´£é‡è®¡ç®—ã€‚

    - **è¯­è¨€**: **Python 3.10+**
    - **3D æ ¸å¿ƒ**:
      - **Nerfstudio**: è®­ç»ƒæ¡†æ¶ï¼Œæä¾›å®Œæ•´çš„ Pipelineã€‚
      - **Gsplat / Diff-Gaussian-Rasterization**: åº•å±‚ CUDA åŠ é€Ÿçš„å…‰æ …åŒ–å™¨ã€‚
      - **PyTorch**: æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚
    - **RAG / è¯­ä¹‰æ ¸å¿ƒ**:
      - **OpenCV-Python**: è§†é¢‘æŠ½å¸§ã€å›¾åƒå¤„ç†ã€‚
      - **ChromaDB**: æœ¬åœ°å‘é‡æ•°æ®åº“ï¼ˆè½»é‡çº§ï¼Œæ— éœ€ç‹¬ç«‹éƒ¨ç½²æœåŠ¡ï¼‰ã€‚
      - **DashScope SDK (é˜¿é‡Œäº‘)** / **ZhipuAI SDK**: è°ƒç”¨äº‘ç«¯å¤šæ¨¡æ€å¤§æ¨¡å‹ã€‚
    - **ä»»åŠ¡é˜Ÿåˆ—**: **Redis-py** (ç›‘å¬ä»»åŠ¡)ã€‚

    #### 5. åŸºç¡€è®¾æ–½ä¸å­˜å‚¨ (Infrastructure)

    - **å¯¹è±¡å­˜å‚¨**: **MinIO** (å…¼å®¹ S3 åè®®ï¼ŒDocker éƒ¨ç½²)ã€‚
      - *å­˜å‚¨å†…å®¹*: ç”¨æˆ·ä¸Šä¼ çš„åŸå§‹è§†é¢‘ (`.mp4`)ã€è®­ç»ƒå¥½çš„æ¨¡å‹ (`.ply`)ã€‚
    - **å…³ç³»å‹æ•°æ®åº“**: **MySQL 8.0**ã€‚
      - *å­˜å‚¨å†…å®¹*: ç”¨æˆ·è¡¨ã€ä»»åŠ¡è¡¨ (Task ID, Status, FilePath)ã€å…³è”å…³ç³»ã€‚
    - **æ¶ˆæ¯é˜Ÿåˆ—**: **Redis**ã€‚
      - *ç”¨é€”*: ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç¼“å†²åŒºã€‚

    ------

    ### äºŒã€ æŠ€æœ¯ååŒä¸æ•°æ®æµè½¬ (Collaboration Flow)

    æ•´ä¸ªç³»ç»Ÿåˆ†ä¸ºä¸‰æ¡æ ¸å¿ƒæ•°æ®é“¾è·¯ï¼š**ä¸Šä¼ é“¾è·¯**ã€**åŠ å·¥é“¾è·¯**ã€**æ¶ˆè´¹é“¾è·¯**ã€‚

    #### 1. ä¸Šä¼ é“¾è·¯ (The Upload Flow)

    *æ ¸å¿ƒç›®æ ‡ï¼šå°†å¤§æ–‡ä»¶ä»æ‰‹æœºé«˜æ•ˆä¼ è¾“åˆ°æœåŠ¡å™¨ï¼Œä¸é˜»å¡ä¸šåŠ¡ç½‘å…³ã€‚*

    1. **é‰´æƒä¸ç”³è¯· (Flutter -> Go)**:
       - ç”¨æˆ·åœ¨ App ç‚¹å‡»ä¸Šä¼ ï¼ŒFlutter å‘ Go å‘é€ `POST /upload/ticket`ã€‚
       - Go è°ƒç”¨ **MinIO SDK** ç”Ÿæˆä¸€ä¸ª **PUT Presigned URL**ï¼ˆé¢„ç­¾åé“¾æ¥ï¼Œæœ‰æ•ˆæœŸ 10 åˆ†é’Ÿï¼‰ï¼Œè¿”å›ç»™ Flutterã€‚
    2. **ç›´ä¼ æ–‡ä»¶ (Flutter -> MinIO)**:
       - Flutter ä½¿ç”¨ **Dio** ç›´æ¥å‘è¯¥ URL ä¸Šä¼ è§†é¢‘æ–‡ä»¶æµã€‚
       - *æŠ€æœ¯ç‚¹*: æµé‡ç›´æ¥èµ°å­˜å‚¨ç½‘å…³ï¼Œä¸ç»è¿‡ Go ä¸šåŠ¡æœåŠ¡å™¨ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚
    3. **ä»»åŠ¡æŠ•é€’ (Flutter -> Go -> Redis)**:
       - ä¸Šä¼ æˆåŠŸåï¼ŒFlutter é€šçŸ¥ Go `POST /task/create`ï¼Œå¸¦ä¸Šæ–‡ä»¶åœ¨ MinIO ä¸­çš„è·¯å¾„ (`s3://...`)ã€‚
       - Go å°†ä»»åŠ¡ä¿¡æ¯åºåˆ—åŒ–ä¸º JSON (`{"task_id": 101, "path": "..."}`)ï¼Œé€šè¿‡ `LPUSH` å†™å…¥ **Redis** é˜Ÿåˆ— `task_queue`ã€‚

    #### 2. åŠ å·¥é“¾è·¯ (The Processing Flow)

    *æ ¸å¿ƒç›®æ ‡ï¼šå¼‚æ­¥å¤„ç†é‡è®¡ç®—ä»»åŠ¡ï¼Œç»“åˆæœ¬åœ°ç®—åŠ›ä¸äº‘ç«¯æ™ºèƒ½ã€‚*

    1. **æ¥å• (Python Worker <- Redis)**:
       - Python è„šæœ¬è¿è¡Œ `BRPOP task_queue`ï¼Œé˜»å¡ç­‰å¾…ã€‚ä¸€æ—¦æœ‰æ–°ä»»åŠ¡ï¼Œç«‹å³å”¤é†’ã€‚
    2. **æ•°æ®å‡†å¤‡ (Python Worker <-> MinIO)**:
       - Python è§£æ JSONï¼Œé€šè¿‡ **Boto3** (S3 SDK) ä» MinIO ä¸‹è½½è§†é¢‘åˆ°æœ¬åœ° SSD ä¸´æ—¶ç›®å½•ã€‚
    3. **å¹¶è¡Œå¤„ç† (Parallel Execution)**:
       - **åˆ†æ”¯ A (3D é‡å»º)**:
         - è°ƒç”¨ `colmap` å‘½ä»¤è¡Œå·¥å…·è¿›è¡Œç¨€ç–é‡å»ºï¼ˆè®¡ç®—ç›¸æœºä½å§¿ï¼‰ã€‚
         - è°ƒç”¨ `nerfstudio` API å¯åŠ¨ GPU è®­ç»ƒï¼ˆçº¦ 20 åˆ†é’Ÿï¼‰ã€‚
         - äº§å‡ºï¼š`model.ply` ç‚¹äº‘æ¨¡å‹ã€‚
       - **åˆ†æ”¯ B (è¯­ä¹‰ç´¢å¼•)**:
         - ä½¿ç”¨ `OpenCV` æ¯éš” 5 ç§’æˆªå–ä¸€å¸§å›¾ç‰‡ã€‚
         - è°ƒç”¨ **é˜¿é‡Œäº‘ Qwen-VL API** (HTTP)ï¼Œå‘é€å›¾ç‰‡ Base64ï¼Œè·å–æ–‡æœ¬æè¿°ã€‚
         - å°†æ–‡æœ¬æè¿° + è§†é¢‘ ID + æ—¶é—´æˆ³å­˜å…¥ **ChromaDB**ï¼ˆæœ¬åœ°åµŒå…¥å¼å­˜å‚¨ï¼‰ã€‚
    4. **ç»“æœå›ä¼  (Python -> MinIO & Go)**:
       - å°† `model.ply` ä¸Šä¼ å› MinIOã€‚
       - è°ƒç”¨ Go çš„å†…éƒ¨æ¥å£ï¼ˆæˆ–ä¿®æ”¹ Redis çŠ¶æ€ï¼‰ï¼Œæ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º `Finished`ã€‚

    #### 3. æ¶ˆè´¹ä¸æœç´¢é“¾è·¯ (The Consumption Flow)

    *æ ¸å¿ƒç›®æ ‡ï¼šæµç•…æµè§ˆ 3D æ¨¡å‹ï¼Œå¹¶èƒ½é€šè¿‡æ–‡å­—å®šä½ç©ºé—´åæ ‡ã€‚*

    1. **æ¨¡å‹åŠ è½½ (Flutter <-> Vue <-> MinIO)**:
       - Flutter è¯·æ±‚ Go è·å–æ¨¡å‹ä¸‹è½½é“¾æ¥ (GET Presigned URL)ã€‚
       - Flutter é€šè¿‡ `WebViewController.runJavaScript` å°†é“¾æ¥ä¼ ç»™ Vueã€‚
       - Vue ä¸­çš„ **Three.js** ç›´æ¥åŠ è½½è¯¥é“¾æ¥ï¼Œæ¸²æŸ“ 3D åœºæ™¯ã€‚
    2. **ç©ºé—´æœç´¢ (Flutter -> Go -> Python -> Flutter)**:
       - **ç”¨æˆ·è¾“å…¥**: "æˆ‘çš„é’¥åŒ™åœ¨å“ªï¼Ÿ"
       - **Flutter**: å‘é€ `GET /search?q=é’¥åŒ™` ç»™ Goã€‚
       - **Go**: è½¬å‘è¯·æ±‚ç»™ Python æä¾›çš„å¾®æœåŠ¡æ¥å£ï¼ˆå¯ä»¥ç”¨ FastAPI å†™ä¸€ä¸ªç®€å•çš„å†…éƒ¨åªè¯»æ¥å£ï¼‰ã€‚
       - **Python**: æŸ¥è¯¢ **ChromaDB**ï¼Œæ‰¾åˆ°ç›¸ä¼¼åº¦æœ€é«˜çš„æ–‡æœ¬å—ï¼ˆ"æ¡Œå­ä¸Šæœ‰ä¸€æŠŠé“¶è‰²é’¥åŒ™"ï¼‰ï¼Œè¿”å›è¯¥å¸§å¯¹åº”çš„ç›¸æœºä½å§¿ (Camera Pose) å’Œ 3D åæ ‡ä¸­å¿ƒã€‚
       - **Flutter**: æ‹¿åˆ°åæ ‡ï¼Œæ§åˆ¶ WebView é‡Œçš„æ‘„åƒæœºé£å‘è¯¥åæ ‡ã€‚

    ------

    ### ä¸‰ã€ å…³é”®åè®®æ€»ç»“

    | **é€šä¿¡ç«¯ç‚¹**          | **åè®®/æ–¹å¼**         | **æ•°æ®æ ¼å¼**      | **ç”¨é€”**                      |
    | --------------------- | --------------------- | ----------------- | ----------------------------- |
    | **Flutter â†” Go**      | **HTTP / 1.1 (REST)** | JSON              | ä¸šåŠ¡æŒ‡ä»¤ (ç™»å½•, æŸ¥åˆ—è¡¨, æœç´ ) |
    | **Flutter â†” MinIO**   | **HTTP (S3 Signed)**  | Binary Stream     | è§†é¢‘ä¸Šä¼ , æ¨¡å‹ä¸‹è½½            |
    | **Go â†” Redis**        | **RESP (TCP)**        | String (JSON)     | ä»»åŠ¡é˜Ÿåˆ— (ç”Ÿäº§è€…)             |
    | **Python â†” Redis**    | **RESP (TCP)**        | String (JSON)     | ä»»åŠ¡é˜Ÿåˆ— (æ¶ˆè´¹è€…)             |
    | **Python â†” Cloud AI** | **HTTPS**             | JSON (Base64 Img) | è§†è§‰è¯­ä¹‰ç†è§£ API è°ƒç”¨         |
    | **Flutter â†” Vue**     | **JavaScriptChannel** | String            | APP ä¸å†…åµŒç½‘é¡µçš„äº¤äº’æ§åˆ¶      |

------

### ä¸‰ã€ æ•°æ®æµè½¬

1. **ä¸Šä¼ æµ**ï¼šæ‰‹æœº (Flutter) -> **MinIO** (å­˜è§†é¢‘)ã€‚
2. **æŒ‡ä»¤æµ**ï¼šæ‰‹æœº -> **Go** (å‘ä»»åŠ¡) -> **Redis** (æ’é˜Ÿ)ã€‚
3. **è®¡ç®—æµ (æ··åˆ)**ï¼š
   - **Python** ä» Redis æ¥å• -> ä» MinIO ä¸‹è§†é¢‘ã€‚
   - **åˆ†æ”¯ A (3DGS)**ï¼šæœ¬åœ° GPU  -> ç”Ÿæˆ `.ply` -> ä¼ å› MinIOã€‚
   - **åˆ†æ”¯ B (RAG)**ï¼šæœ¬åœ° CPU æŠ½ 10 å¼ å›¾ -> å‘ç»™ **é˜¿é‡Œäº‘ API** -> æ‹¿åˆ°æ–‡å­— -> å­˜å…¥æœ¬åœ° **ChromaDB**ã€‚
4. **å±•ç¤ºæµ**ï¼š
   - **çœ‹ 3D**ï¼šæ‰‹æœºä» MinIO ä¸‹è½½ `.ply` æ¸²æŸ“ã€‚
   - **æœç‰©å“**ï¼šæ‰‹æœºæœâ€œé’¥åŒ™â€ -> Go æŸ¥ ChromaDB -> è¿”å›åæ ‡ -> æ‰‹æœºé•œå¤´é£è¿‡å»ã€‚





### åœºæ™¯å®šä¹‰ï¼šç”¨æˆ·æ‰«ææˆ¿é—´å¹¶æœç´¢â€œæˆ‘çš„é’¥åŒ™åœ¨å“ªï¼Ÿâ€

### ç¬¬ä¸€é˜¶æ®µï¼šç©ºé—´é‡‡é›†ä¸ä¸Šä¼  (Scan & Upload)

**1. ç”¨æˆ·äº¤äº’æµç¨‹ (User Flow)**

- **åŠ¨ä½œ**ï¼šç”¨æˆ·æ‰“å¼€ Appï¼Œç‚¹å‡»â€œæ–°å»ºè®°å¿†â€ï¼Œä½¿ç”¨æ‘„åƒå¤´ç¯ç»•æ‹æ‘„æˆ¿é—´ï¼ˆ1-2åˆ†é’Ÿï¼‰ã€‚
- **ç•Œé¢**ï¼šå±å¹•æ˜¾ç¤ºå¼•å¯¼ç•Œé¢ï¼Œæ‹æ‘„å®Œæˆåç‚¹å‡»â€œä¸Šä¼ ç”Ÿæˆâ€ã€‚
- **åé¦ˆ**ï¼šApp æ˜¾ç¤ºâ€œä¸Šä¼ ä¸­...â€ï¼Œéšåè¿›å…¥â€œäº‘ç«¯æ„å»ºä¸­ï¼ˆæ’é˜Ÿä¸­ï¼‰â€çŠ¶æ€ã€‚

**2. æ•°æ®ååŒä¸é€šä¿¡ç»†èŠ‚ (Data & Protocol)**

| **æ­¥éª¤**        | **æº (Source)**  | **ç›®æ ‡ (Dest)** | **åŠ¨ä½œæè¿°**                   | **åè®®/é€šä¿¡æ–¹å¼**                             | **æ•°æ®å†…å®¹**                                                 |
| --------------- | ---------------- | --------------- | ------------------------------ | --------------------------------------------- | ------------------------------------------------------------ |
| **1. ç”³è¯·å‡­è¯** | Mobile (Flutter) | Server (Go)     | è¯·æ±‚ä¸Šä¼ æˆæƒ                   | **HTTPS (REST)** `POST /api/v1/upload/ticket` | Header: Auth-Token Body: `{filename: "room.mp4", size: 500MB}` |
| **2. ç­¾å‘é“¾æ¥** | Server (Go)      | MinIO (Local)   | ç”Ÿæˆé¢„ç­¾å URL (Presigned URL) | **S3 SDK (Internal)**                         | å†…éƒ¨ç”Ÿæˆå¸¦ç­¾åçš„ URLï¼Œæœ‰æ•ˆæœŸ 10åˆ†é’Ÿ                          |
| **3. ç›´ä¼ æ–‡ä»¶** | Mobile (Flutter) | MinIO (Storage) | è§†é¢‘æµç›´æ¥ä¸Šä¼                  | **HTTPS (PUT)** *(ä¸ç»è¿‡ä¸šåŠ¡åç«¯)*            | Binary Video Stream                                          |
| **4. æäº¤ä»»åŠ¡** | Mobile (Flutter) | Server (Go)     | é€šçŸ¥ä¸Šä¼ å®Œæˆï¼Œè§¦å‘ä»»åŠ¡         | **HTTPS (REST)** `POST /api/v1/tasks`         | `{video_path: "s3://bucket/room.mp4", task_type: "3dgs_rag"}` |
| **5. ä»»åŠ¡å…¥é˜Ÿ** | Server (Go)      | Redis           | å°†ä»»åŠ¡æ¨å…¥é˜Ÿåˆ—                 | **TCP (RESPåè®®)** `LPUSH task_queue`         | `{"id": 101, "path": "...", "uid": "user_1"}`                |

------

### ç¬¬äºŒé˜¶æ®µï¼šåŒæµå¹¶è¡Œè®¡ç®— (Parallel Processing)

æ­¤é˜¶æ®µç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œä¸»è¦åœ¨åå°è¿è¡Œã€‚**Python Worker** ä» Redis æ‹¿åˆ°ä»»åŠ¡åï¼Œå¹¶è¡Œå¼€å¯ä¸¤ä¸ªçº¿ç¨‹/è¿›ç¨‹ã€‚

**1. åˆ†æ”¯ Aï¼š3D é‡å»º (3DGS Pipeline)**

| **æ­¥éª¤**        | **ç»„ä»¶**      | **åŠ¨ä½œæè¿°**                   | **æ¶‰åŠå·¥å…·/åº“**     | **å¤‡æ³¨**              |
| --------------- | ------------- | ------------------------------ | ------------------- | --------------------- |
| **1. ä¸‹è½½è§†é¢‘** | Python Worker | ä» MinIO ä¸‹è½½è§†é¢‘åˆ°æœ¬åœ° SSD    | `boto3` (S3åè®®)    | å†…ç½‘ä¼ è¾“ï¼Œæå¿«        |
| **2. ç¨€ç–é‡å»º** | 3DGS Engine   | è¿è¡Œ COLMAP æå–ç›¸æœºä½å§¿       | `colmap` (CLI)      | CPU å¯†é›†å‹            |
| **3. æ¨¡å‹è®­ç»ƒ** | 3DGS Engine   | è¿è¡Œ Gaussian Splatting è®­ç»ƒ   | `nerfstudio` / CUDA | **GPU æ»¡è½½ (20åˆ†é’Ÿ)** |
| **4. ç»“æœå›ä¼ ** | Python Worker | å°†ç”Ÿæˆçš„ `.ply` æ¨¡å‹ä¸Šä¼  MinIO | `boto3` (S3åè®®)    | ç”Ÿæˆçº¦ 100MB æ–‡ä»¶     |

**2. åˆ†æ”¯ Bï¼šè¯­ä¹‰ç†è§£ (Cloud RAG Pipeline)**

| **æ­¥éª¤**          | **ç»„ä»¶**                | **åŠ¨ä½œæè¿°**                    | **æ¶‰åŠ API / åè®®**                 | **æ•°æ®å†…å®¹**                                                 |
| ----------------- | ----------------------- | ------------------------------- | ----------------------------------- | ------------------------------------------------------------ |
| **1. å…³é”®å¸§æå–** | Python RAG              | ä½¿ç”¨ OpenCV æ¯éš” 5 ç§’æˆªå–ä¸€å¼ å›¾ | `cv2` (Local)                       | äº§ç”Ÿçº¦ 15 å¼ å›¾ç‰‡ (JPG)                                       |
| **2. è§†è§‰ç†è§£**   | Python -> **Cloud API** | **è°ƒç”¨å¤–éƒ¨å¤§æ¨¡å‹ API**          | **HTTPS (POST)** OpenAI / é˜¿é‡Œ Qwen | Payload: `{image: Base64, prompt: "æè¿°ç‰©ä½“å’Œä½ç½®"}`         |
| **3. å‘é‡å­˜å‚¨**   | Python -> ChromaDB      | å°† API è¿”å›çš„æ–‡æœ¬å­˜å…¥æœ¬åœ°å‘é‡åº“ | Internal Lib Call                   | æ–‡æœ¬: "æ¡Œå­ä¸Šæœ‰æŠŠé“¶è‰²é’¥åŒ™..." Meta: `{time: 10s, xyz: [1,2,3]}` |

**3. ä»»åŠ¡å®Œç»“**

- **åŠ¨ä½œ**ï¼šPython Worker å®Œæˆæ‰€æœ‰æ­¥éª¤åï¼Œå†™å…¥ Redis çŠ¶æ€æˆ–é€šè¿‡å†…éƒ¨ HTTP å›è°ƒé€šçŸ¥ Go Serverã€‚
- **Server**ï¼šæ›´æ–° MySQL ä»»åŠ¡çŠ¶æ€ä¸º `finished`ï¼Œå¹¶å‘ç”¨æˆ·æ‰‹æœºæ¨é€é€šçŸ¥ï¼ˆé€šè¿‡ WebSocket æˆ– FCMï¼‰ã€‚

------

### ç¬¬ä¸‰é˜¶æ®µï¼šå¯è§†åŒ–ä¸ç©ºé—´æ£€ç´¢ (Visualize & Search)

**1. ç”¨æˆ·äº¤äº’æµç¨‹**

- **æŸ¥çœ‹**ï¼šç”¨æˆ·ç‚¹å‡»ä»»åŠ¡ï¼Œæ‰‹æœºåŠ è½½ 3D åœºæ™¯ï¼Œå¯ä»¥è‡ªç”±æ‹–æ‹½è§†è§’ã€‚
- **æœç´¢**ï¼šç”¨æˆ·åœ¨æœç´¢æ¡†è¾“å…¥â€œé’¥åŒ™â€ï¼Œç‚¹å‡»æœç´¢ã€‚
- **åé¦ˆ**ï¼šé•œå¤´è‡ªåŠ¨é£è·ƒå¹¶èšç„¦åˆ°æ¡Œå­ä¸Šçš„é’¥åŒ™ä½ç½®ã€‚

**2. æ•°æ®ååŒä¸é€šä¿¡ç»†èŠ‚**

| **æ­¥éª¤**        | **æº (Source)** | **ç›®æ ‡ (Dest)**           | **åŠ¨ä½œæè¿°**                 | **åè®®/é€šä¿¡æ–¹å¼**                       | **æ ¸å¿ƒé€»è¾‘**                                     |
| --------------- | --------------- | ------------------------- | ---------------------------- | --------------------------------------- | ------------------------------------------------ |
| **1. åŠ è½½æ¨¡å‹** | Mobile          | MinIO                     | ä¸‹è½½ `.ply` 3D æ–‡ä»¶          | **HTTPS (GET)**                         | è¾¹ä¸‹è¾¹æ’­ (Stream) æˆ– é¢„åŠ è½½                      |
| **2. å‘èµ·æœç´¢** | Mobile          | Server (Go)               | æŸ¥è¯¢å…³é”®è¯                   | **HTTPS (GET)** `/api/v1/search?q=é’¥åŒ™` |                                                  |
| **3. è¯­ä¹‰æ£€ç´¢** | Server (Go)     | **Python Search Service** | è¯·æ±‚å‘é‡åŒ¹é…                 | **Internal HTTP / gRPC**                | Go è°ƒ Python çš„å†…éƒ¨å¾®æœåŠ¡æ¥å£ Python æŸ¥ ChromaDB |
| **4. è¿”å›åæ ‡** | Server (Go)     | Mobile                    | è¿”å›ç‰©å“çš„ç©ºé—´åæ ‡ä¸ç›¸æœºä½å§¿ | **JSON Response**                       | `{target: "key", pos: [x,y,z], look_at: [...]}`  |
| **5. é•œå¤´æ§åˆ¶** | Mobile          | æ¸²æŸ“å¼•æ“                  | é©±åŠ¨ç›¸æœºç§»åŠ¨                 | **WebGL / Three.js**                    | å‰ç«¯é€»è¾‘ï¼Œæ— ç½‘ç»œäº¤äº’                             |

------

### æ€»ç»“ï¼šå…³é”®æŠ€æœ¯æ ˆé€ŸæŸ¥è¡¨

- **å¯¹å¤–é€šä¿¡åè®®**ï¼šHTTPS (REST API) + WebSocket (å¯é€‰ï¼Œç”¨äºè¿›åº¦æ¨é€)ã€‚
- **å¤§æ–‡ä»¶ä¼ è¾“åè®®**ï¼šS3 (Presigned URL) - **è¿™æ˜¯æ€§èƒ½å…³é”®**ï¼Œé¿å…é˜»å¡ä¸šåŠ¡æœåŠ¡å™¨ã€‚
- **å†…éƒ¨ååŒåè®®**ï¼š
  - **ä»»åŠ¡è°ƒåº¦**ï¼šRedis Protocol (TCP) - ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ã€‚
  - **æœç´ æœåŠ¡**ï¼šInternal HTTP (FastAPI) æˆ– gRPC - Go è°ƒç”¨ Python è¿›è¡Œå®æ—¶æ£€ç´¢ã€‚
- **äº‘ç«¯ AI äº¤äº’**ï¼šHTTPS API (OpenAI Schema) - ä¼ è¾“ Base64 å›¾ç‰‡ï¼Œæ¥æ”¶ JSON æ–‡æœ¬ã€‚





# æµç¨‹å›¾

```mermaid
sequenceDiagram
    autonumber
participant User as ğŸ‘¤ ç”¨æˆ· (User)
participant App as ğŸ“± ç§»åŠ¨ç«¯ (Flutter)
participant Vue as ğŸ–¼ï¸ 3D æµè§ˆå™¨ (Vue3/Three.js)
participant Go as ğŸ§  ä¸šåŠ¡åç«¯ (Go Server)
participant MinIO as ğŸ—„ï¸ å¯¹è±¡å­˜å‚¨ (MinIO/S3)
participant Redis as ğŸ“¨ æ¶ˆæ¯é˜Ÿåˆ— (Redis)
participant PyWorker as âš™ï¸ è®¡ç®—å¼•æ“ (Python Worker)
participant VectorDB as ğŸ” å‘é‡åº“ (ChromaDB)

Note over User, MinIO: === é˜¶æ®µä¸€ï¼šæ‰«æä¸ä¸Šä¼  (Scan & Upload) ===
User->>App: 1. ç‚¹å‡»â€œæ–°å»ºè®°å¿†â€ï¼Œæ‹æ‘„è§†é¢‘
App->>Go: 2. è¯·æ±‚ä¸Šä¼ å‡­è¯ (POST /upload/ticket)
Go->>MinIO: 3. ç”³è¯·é¢„ç­¾å URL (Presigned Put URL)
MinIO-->>Go: è¿”å›ä¸´æ—¶ä¸Šä¼ é“¾æ¥
Go-->>App: è¿”å› URL
App->>MinIO: 4. ç›´ä¼ è§†é¢‘æ–‡ä»¶ (PUT Binary Stream)
MinIO-->>App: ä¸Šä¼ æˆåŠŸ (200 OK)
App->>Go: 5. æäº¤ä»»åŠ¡ (POST /task/create) <br/> {video_path: "s3://..."}
Go->>Redis: 6. ä»»åŠ¡å…¥é˜Ÿ (LPUSH task_queue)
Go-->>App: ä»»åŠ¡å·²æ¥æ”¶ (æ’é˜Ÿä¸­)
App-->>User: æ˜¾ç¤ºâ€œäº‘ç«¯ç”Ÿæˆä¸­...â€

Note over Redis, VectorDB: === é˜¶æ®µäºŒï¼šå¼‚æ­¥ç”Ÿäº§ (Async Processing) ===
loop è½®è¯¢ä»»åŠ¡ (Polling)
    PyWorker->>Redis: 7. è·å–ä»»åŠ¡ (BRPOP)
end
PyWorker->>MinIO: 8. ä¸‹è½½è§†é¢‘æ–‡ä»¶
par å¹¶è¡Œå¤„ç†
    PyWorker->>PyWorker: 9a. 3DGS è®­ç»ƒ (Nerfstudio/GPU)
    PyWorker->>MinIO: ä¸Šä¼  .ply æ¨¡å‹æ–‡ä»¶
and
    PyWorker->>PyWorker: 9b. å…³é”®å¸§æŠ½å– & AI è¯†åˆ«
    PyWorker->>VectorDB: å­˜å…¥å‘é‡ç´¢å¼• (Add Embeddings)
end
PyWorker->>Go: 10. å›è°ƒé€šçŸ¥ä»»åŠ¡å®Œæˆ (Webhook/Redis)
Go-->>App: æ¨é€é€šçŸ¥ "è®°å¿†æ„å»ºå®Œæˆ"

Note over User, VectorDB: === é˜¶æ®µä¸‰ï¼šæµè§ˆä¸ RAG æœç´¢ (Visualize & Search) ===
User->>App: 11. ç‚¹å‡»æŸ¥çœ‹æ¨¡å‹
App->>Go: è¯·æ±‚æ¨¡å‹ä¸‹è½½é“¾æ¥
Go->>MinIO: ç”³è¯·ä¸‹è½½å‡­è¯ (Presigned Get URL)
Go-->>App: è¿”å› .ply URL
App->>Vue: 12. åŠ è½½ URL (runJavaScript)
Vue->>MinIO: ä¸‹è½½å¹¶æµå¼æ¸²æŸ“ 3D åœºæ™¯
Vue-->>User: å±•ç¤º 3D ç”»é¢

User->>App: 13. æœç´¢ "æˆ‘çš„é’¥åŒ™åœ¨å“ª"
App->>Go: å‘èµ·æœç´¢è¯·æ±‚ (GET /search?q=é’¥åŒ™)
Go->>PyWorker: è½¬å‘æ£€ç´¢è¯·æ±‚ (RPC/HTTP)
PyWorker->>VectorDB: 14. è¯­ä¹‰ç›¸ä¼¼åº¦åŒ¹é…
VectorDB-->>PyWorker: è¿”å› Top-K ç»“æœ (ä½ç½®/ä½å§¿)
PyWorker-->>Go: è¿”å›åæ ‡æ•°æ®
Go-->>App: è¿”å›ç›®æ ‡ä½ç½® {x, y, z}
App->>Vue: 15. æ§åˆ¶ç›¸æœºé£è·ƒ (JSBridge)
Vue-->>User: é•œå¤´èšç„¦åˆ°é’¥åŒ™ä½ç½®
```



## å®è§‚æ¶æ„å›¾

```mermaid
sequenceDiagram
    autonumber
    %% è®¾ç½®å›¾è¡¨èƒŒæ™¯é¢œè‰²ï¼Œæ–¹ä¾¿æ‰“å°
    %% participant å®šä¹‰ç®€å†™å’Œæ¢è¡Œï¼ŒèŠ‚çœå®½åº¦
    participant C as ğŸ“± ç§»åŠ¨ç«¯é›†æˆ<br/>(Flutter/Vue)
    participant S as ğŸ§  ä¸šåŠ¡åç«¯<br/>(Go + Redis)
    participant M as ğŸ—„ï¸ å¯¹è±¡å­˜å‚¨<br/>(MinIO)
    participant W as âš™ï¸ è®¡ç®—èŠ‚ç‚¹<br/>(Python + GPU)
box rgb(240, 248, 255) å®¢æˆ·ç«¯å±‚
    participant C
end
box rgb(255, 250, 240) äº‘ç«¯è®¾æ–½
    participant S
    participant M
    participant W
end

Note over C, W: === ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®ç”Ÿäº§ (ä¸Šä¼  & è®­ç»ƒ) ===

C->>S: 1. ç”³è¯·ä¸Šä¼  Token
S->>M: è·å– Presigned Put URL
M-->>C: è¿”å›ä¸Šä¼ é“¾æ¥
C->>M: 2. ç›´ä¼ è§†é¢‘æ–‡ä»¶ (Binary Stream)
C->>S: 3. åˆ›å»ºä»»åŠ¡ (Task Create)
S->>S: å†™å…¥ Redis é˜Ÿåˆ—
S-->>C: è¿”å› "æ’é˜Ÿä¸­"

par å¼‚æ­¥å¹¶è¡Œå¤„ç†
    W->>S: è½®è¯¢è·å–ä»»åŠ¡
    W->>M: ä¸‹è½½è§†é¢‘
    W->>W: A. 3DGS å»ºæ¨¡è®­ç»ƒ
    W->>W: B. RAG è¯­ä¹‰åˆ†æ
    W->>M: ä¸Šä¼  .ply æ¨¡å‹æ–‡ä»¶
end

W->>S: ä»»åŠ¡å®Œæˆå›è°ƒ
S-->>C: æ¨é€ "è®°å¿†æ„å»ºå®Œæˆ"

Note over C, W: === ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®æ¶ˆè´¹ (æµè§ˆ & æœç´¢) ===

C->>S: 4. è¯·æ±‚æ¨¡å‹åœ°å€
S->>M: è·å– Presigned Get URL
S-->>C: è¿”å›ä¸‹è½½é“¾æ¥
C->>M: 5. åŠ è½½ 3D åœºæ™¯ (Three.js)

rect rgb(240, 255, 240)
    Note right of C: è¯­ä¹‰æ£€ç´¢æµç¨‹
    C->>S: 6. æœç´¢ "é’¥åŒ™åœ¨å“ª?"
    S->>W: RPC è°ƒç”¨æœç´¢æ¥å£
    W->>W: ChromaDB å‘é‡åŒ¹é…
    W-->>S: è¿”å› {xyz, camera_pose}
    S-->>C: è¿”å›ç›®æ ‡åæ ‡
    C->>C: é•œå¤´è‡ªåŠ¨é£è·ƒ
end
```

### ä¸Šä¼ ä¸æ„å»ºæµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant App as ğŸ“± App
    participant Go as ğŸ§  Go Server
    participant Redis as ğŸ“¨ Redis
    participant MinIO as ğŸ—„ï¸ MinIO
    participant Worker as âš™ï¸ Python Worker

    Note over App, Worker: æ ¸å¿ƒé“¾è·¯ï¼šè§†é¢‘ä¸Šä¼  -> å¼‚æ­¥è®­ç»ƒ
    App->>Go: 1. è¯·æ±‚ä¸Šä¼ 
    Go->>MinIO: ç­¾å‘ URL
    App->>MinIO: 2. ä¸Šä¼ è§†é¢‘
    App->>Go: 3. æäº¤ä»»åŠ¡
    Go->>Redis: LPUSH ä»»åŠ¡
    
    loop Worker è½®è¯¢
        Worker->>Redis: BRPOP ä»»åŠ¡
    end
    
    Worker->>MinIO: ä¸‹è½½è§†é¢‘
    Worker->>Worker: 3DGS è®­ç»ƒ (20min)
    Worker->>MinIO: ä¸Šä¼  .ply æ¨¡å‹
    Worker->>Go: æ›´æ–°çŠ¶æ€ Finished
```

### æµè§ˆä¸æœç´¢æµç¨‹

```mermaid
sequenceDiagram
    autonumber
    participant App as ğŸ“± App
    participant Vue as ğŸ–¼ï¸ Vue3
    participant Go as ğŸ§  Go Server
    participant Worker as âš™ï¸ Search API
    participant MinIO as ğŸ—„ï¸ MinIO

    Note over App, MinIO: æ ¸å¿ƒé“¾è·¯ï¼šæ¨¡å‹åŠ è½½ + ç©ºé—´æ£€ç´¢
    App->>Go: 1. è·å–æ¨¡å‹ URL
    Go-->>App: è¿”å› URL
    App->>Vue: 2. æ³¨å…¥ JS (loadModel)
    Vue->>MinIO: ä¸‹è½½å¹¶æ¸²æŸ“
    
    User->>App: 3. æœç´¢ç‰©å“
    App->>Go: GET /search
    Go->>Worker: 4. å‘é‡æ£€ç´¢
    Worker-->>Go: è¿”å›åæ ‡
    Go-->>App: è¿”å›æ•°æ®
    App->>Vue: 5. æ³¨å…¥ JS (moveCamera)
```

